---
title: 'Enum í†ºì•„ë³´ê¸°(2)'
date: 2024-01-20T16:51:32+09:00
draft: false
tags: ["kotlin"]
categories: ["development"]
---

ì´ë²ˆ ì‹œê°„ì—ëŠ” Enumì„ ì‚¬ìš©í•˜ë©´ì„œ ì‰½ê²Œ ë†“ì§ˆ ìˆ˜ ìˆëŠ” ì„±ëŠ¥ì ì¸ ì¸¡ë©´ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

# values() vs entires
Enum ë‚´ë¶€ì˜ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ì‹ì€ í”íˆ `values()`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 
`values()`ëŠ” ì •ì˜ëœ ëª¨ë“  ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë°°ì—´ í˜•íƒœë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
ë”°ë¼ì„œ ì¼ë°˜ì ìœ¼ë¡œëŠ” `values()`ì™€ ìŠ¤íŠ¸ë¦¼ì„ ì¡°í•©í•˜ì—¬ ì›í•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
SomeEnum.values().filter { /* condition */ }
```

## values() ì˜ ë¬¸ì œ
í•˜ì§€ë§Œ `values()`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°ì—ëŠ” ëª‡ê°€ì§€ ì¹˜ëª…ì ì¸ ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

* `values()` í˜¸ì¶œê³¼ ë™ì‹œì— ë©”ëª¨ë¦¬ì— ìƒˆë¡œìš´ ë°°ì—´ì„ í• ë‹¹í•˜ì—¬ ì—˜ë¦¬ë¨¼íŠ¸ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
* `values()`ê°€ ë°˜í™˜í•˜ëŠ” `Array` íƒ€ì…ì€ ìˆ˜ì •ì´ ê°€ëŠ¥í•œ(mutable) íƒ€ì…ì…ë‹ˆë‹¤.
* í™œìš©ì„ ìœ„í•´ì„œ ë°°ì—´ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ë°”ê¾¸ëŠ” ë°˜ë³µì ì¸ ì‘ì—…ì´ ë™ë°˜ë©ë‹ˆë‹¤.

ì„±ëŠ¥ì ì¸ ì¸¡ë©´ì—ì„œ ë´¤ì„ ë•Œ `values()`ëŠ” ë§¤ë²ˆ ìƒˆë¡­ê²Œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ ì •ì˜ëœ ì—˜ë¦¬ë¨¼íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ ì˜¤ë²„í—¤ë“œê°€ í° ì‘ì—…ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë§Œì•½ í•œ Enumì— ì •ì˜í•œ ì—˜ë¦¬ë¨¼íŠ¸ê°€ ë§ê³  ë‚´ë¶€ í”„ë¡œí¼í‹°ë„ ë‹¤ì–‘í•˜ë‹¤ë©´ ê·¸ë§Œí¼ ë¶€í•˜ê°€ í° ì‘ì—…ì´ ë  ê²ƒì…ë‹ˆë‹¤.
ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ì„œ Kotlin 1.9 ë¶€í„°ëŠ” `entries`ë¼ëŠ” ìƒˆë¡œìš´ í”„ë¡œí¼í‹°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## entriesì˜ ì‚¬ìš©

`entries`ëŠ” `EnumEntries` íƒ€ì…ì„ ë°˜í™˜í•©ë‹ˆë‹¤. 
ê³µì‹ ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ì½”ë“œë¥¼ ì°¸ê³ í•˜ë©´ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì†í•œ ì¸í„°í˜ì´ìŠ¤ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
@SinceKotlin("1.9")
@WasExperimental(ExperimentalStdlibApi::class)
public sealed interface EnumEntries<E : Enum<E>> : List<E>
```

ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ `entries`ëŠ” ë¯¸ë¦¬ ì •ì˜í•œ ë¦¬ìŠ¤íŠ¸ë¥¼(pre-allocated) ë°˜í™˜í•©ë‹ˆë‹¤. 
ë”°ë¼ì„œ ë§¤ í˜¸ì¶œë§ˆë‹¤ ë©”ëª¨ë¦¬ë¥¼ ì •ì˜í•´ì•¼ í–ˆë˜ `values()`ê°€ ê°€ì¡Œë˜ ë¬¸ì œì ì„ ê°œì„ ì‹œì¼°ìŠµë‹ˆë‹¤.
ì¶”ê°€ë¡œ `List` íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì— ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•˜ê³ (immutable) í™œìš©ì´ ë„“ë‹¤ëŠ” ì¥ì ì´ ìƒê²¨ IDEì—ì„œë„ `values()`ë³´ë‹¤ `entries`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.

### ì°¸ê³ ğŸ˜…
ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë¦° ê²°ê³¼ëŠ” ì˜ì™¸ë¡œ `values()`ì˜ ì†ë„ê°€ ë” ë¹ ë¥¸ ê²ƒìœ¼ë¡œ í™•ì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. 
í˜„ì¬ë¡œëŠ” ë°°ì—´ê³¼ ë¦¬ìŠ¤íŠ¸ì˜ ì°¨ì´ë¡œ ì¸í•œ ê²°ê³¼ì´ê±°ë‚˜ í…ŒìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•œ `EnumSut`ì˜ ì—˜ë¦¬ë¨¼íŠ¸ ê°œìˆ˜(10ê°œ)ê°€ ë‘ ì‘ì—…ì˜ ì°¨ì´ë¥¼ ê·¹ëŒ€í™” ì‹œí‚¤ì§€ ëª»í•œê²Œ ì•„ë‹ê¹Œ ì¶”ì¸¡ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

```kotlin
// 10ì–µë²ˆ ë°˜ë³µ 

// values() 20958 ms
fun ofCodeWithValues(code: String): EnumSut {
    return values().firstOrNull { it.code == code } ?: DEFAULT
}
// entries 21682 ms
fun ofCodeWithEntries(code: String): EnumSut {
    return entries.firstOrNull { it.code == code } ?: DEFAULT
}
```

# Enumì„ ì¡°íšŒí•˜ëŠ” ë°©ì‹
Enumì„ ì‚¬ìš©í•˜ë©´ì„œ ì›í•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ì— í•´ë‹¹í•˜ëŠ” ë³€ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ Enumì´ ê°€ì§€ëŠ” í”„ë¡œí¼í‹°ì— ë”°ë¼ì„œ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ìƒí™©ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ Enumì„ `name`ì„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•  ë•Œì²˜ëŸ¼ ë§ì…ë‹ˆë‹¤.

ë³´í†µì€ ìœ„ì—ì„œ ì†Œê°œí•œ `values()`ë‚˜ `entries`ë¥¼ `filter` í•¨ìˆ˜ì™€ ê°™ì´ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë¹„êµì  ì‰½ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ $$O(n)$$ì˜ ë³µì¡ë„ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì— ë‹¨ì‹œê°„ì— ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ìƒí™©ì—ì„œëŠ” ìˆœíšŒí•˜ì—¬ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ì‹ì€ ì í•©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‹¤í—˜ğŸ§ª
ê°„ë‹¨í•œ í…ŒìŠ¤íŒ…ì„ í†µí•´ì„œ ìˆœíšŒí•˜ëŠ” ë°©ì‹ê³¼ í”„ë¡œí¼í‹°ë¥¼ `Map`ìœ¼ë¡œ ë³€í˜•í•˜ì—¬ ì¡°íšŒí•˜ëŠ” ë°©ì‹ì„ ë¹„êµí•´ ë´…ì‹œë‹¤.

>ê°€ì„¤ì€ "Mapì„ ì´ìš©í•œ ì¡°íšŒëŠ” $$O(1)$$ë¡œ $$O(n)$$ì¸ ìˆœíšŒ ë°©ì‹ë³´ë‹¤ ë” íš¨ìœ¨ì ì¼ ê²ƒì´ë‹¤"ëŠ” ê²ë‹ˆë‹¤.

ì‹¤í—˜í•  ì¼€ì´ìŠ¤ë¥¼ ì •ë¦¬í•´ ë³´ë©´ nameì„ ì‚¬ìš©í•  ë•Œì™€ ì»¤ìŠ¤í…€ í”„ë¡œí”„í„°ë¥¼ ì¡°íšŒí•  ë•Œë¡œ ë‚˜ëˆ´ìŠµë‹ˆë‹¤. 
`ordinal`ì„ ì œì™¸í•œ ì´ìœ ëŠ” ë³´í†µ ì‹¤ì œ ìƒí™©ì—ì„œ `ordinal`ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ê²ƒì€ ìœ„í—˜í•  ìˆ˜ ìˆì–´ ì´ ì¼€ì´ìŠ¤ëŠ” ë°°ì œí–ˆìŠµë‹ˆë‹¤.

### Map ë§Œë“¤ê¸°
Mapì„ ë§Œë“œëŠ” ë°©ì‹ì€ entriesì™€ associatedByë¥¼ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
```kotlin
val codeMap: Map<String, EnumSut> = entries.associateBy { it.code }
private val nameMap: Map<String, EnumSut> = entries.associateBy { it.name }
```

`name`ì˜ ê²½ìš°ëŠ” `valueOf()`ë¼ëŠ” ë©”ì„œë“œë¥¼ ì§€ì›í•˜ê³  ìˆê¸° ë•Œë¬¸ì— `nameMap`ê³¼ `valueOf()` ë°©ì‹ì„ í…ŒìŠ¤íŠ¸í•˜ì˜€ìŠµë‹ˆë‹¤.
`valueOf()`ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ë‚´ë¶€ì— `Map` í˜•íƒœë¡œ ì €ì¥í•˜ê³  ìˆëŠ” `enumConstantDirectory`ì—ì„œ ì›í•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. 

```java
// Enum.java
public static <T extends Enum<T>> T valueOf(Class<T> enumType,
                                            String name) {
    T result = enumType.enumConstantDirectory().get(name);
    if (result != null)
        return result;
    if (name == null)
        throw new NullPointerException("Name is null");
    throw new IllegalArgumentException(
        "No enum constant " + enumType.getCanonicalName() + "." + name);
}

// Class.java
Map<String, T> enumConstantDirectory() {
    Map<String, T> directory = enumConstantDirectory;
    if (directory == null) {
        T[] universe = getEnumConstantsShared();
        if (universe == null)
            throw new IllegalArgumentException(
                getName() + " is not an enum type");
        directory = new HashMap<>((int)(universe.length / 0.75f) + 1);
        for (T constant : universe) {
            directory.put(((Enum<?>)constant).name(), constant);
        }
        enumConstantDirectory = directory;
    }
    return directory;
}
```

## ì‹¤í—˜ ê²°ê³¼ğŸ§ª
ì‹¤í—˜ ê²°ê³¼ëŠ” ì˜ˆìƒëŒ€ë¡œ Map í˜•íƒœë¥¼ êµ¬ì„±í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ëŒë‹¤ë¥¼ ì‚¬ìš©í•œ ë°©ì‹ë³´ë‹¤ í›¨ì”¬ ë¹ ë¥´ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

| ë©”ì„œë“œ            | ì‹œê°„     | ë¹„êµ | ì˜ˆìƒ ë³µì¡ë„ | ë¹„ê³            |
| ----------------- | -------- | ---- | ----------- | -------------- |
| ofNameByMap       | 1108 ms  | 1    | O(1)        | `nameMap` ì‚¬ìš© |
| valueOf           | 3415 ms  | 3    | O(1)        | `valueOf` ì‚¬ìš© |
| ofCodeByMap       | 4215 ms  | 3.8  | O(1)        | `codeMap` ì‚¬ìš© |
| ofCodeWithEntries | 21624 ms | 19.5 | O(n)        | `filter` ì‚¬ìš©  |

ì‹¤í—˜ ê²°ê³¼ë¥¼ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
* Enumì˜ ê²½ìš° `name`ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°íšŒë¥¼ í•˜ëŠ” ê²ƒì´ ê°€ì¥ íš¨ìœ¨ì ì…ë‹ˆë‹¤.
* ì»¤ìŠ¤í…€ í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ `Map`ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `filter`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ë³´ë‹¤ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤.

# ê²°ë¡ 
ì§€ê¸ˆê¹Œì§€ Enumì— ëŒ€í•œ ë¶„ì„ì„ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.


# References
* [Kotlin Enums â€” Replace values() with entries](https://engineering.teknasyon.com/kotlin-enums-replace-values-with-entries-bbc91caffb2a)